\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={利用高德地图API生成行政区划图},
            pdfauthor={远举云中},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{利用高德地图API生成行政区划图}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{远举云中}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2018年3月15日}

\usepackage{ctex}

\begin{document}
\maketitle

\subsubsection{介绍}

在利用地图开展各种分析或制图时，准确的行政区划底图往往是不可或缺的。但由于我国目前行政区划（特别是区县级）调整比较频繁，互联网上的免费资源通常比较陈旧，只用这样的底图往往就不能准确反映现实情况了。好在高德地图提供了行政区域查询的WEB服务API\href{http://lbs.amap.com/api/webservice/guide/api/district/}{接口}可以通过这个接口查询我国各级行政区的行政区划地理空间信息，并利用返回的点坐标生成各级行政区划图。这样就可以利用高德地图的数据生产比较新的行政区划图了，而且高德说是\textbf{唯一能让用户查询到乡镇/街道级别信息且小时级更新数据的公开API}惊喜不惊喜，意外不意外？废话不多说，下面我们就用R语言来即时生成行政区划底图吧。

\subsubsection{抓取信息}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{'httr'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'jsonlite'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'tidyverse'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'rlist'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'Rgctc2'}\NormalTok{,}\DataTypeTok{lib.loc=}\StringTok{'~/GitHub/R_coordination_transformation'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'sf'}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{'showtext'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

首先自然是写抓取信息的函数，利用高德的官方指南很容易搞定。

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{digits=}\DecValTok{11}\NormalTok{)}
\NormalTok{get_location<-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(address)\{}
\NormalTok{  key =}\StringTok{ '7c6b6c0d1b641f4aa9cdb7d2229ae728'}                            \CommentTok{#??ҪԤ??????һ???ߵ?API??key}
\NormalTok{  url =}\StringTok{ 'http://restapi.amap.com/v3/config/district?'} \OperatorTok{%>%}
\StringTok{        }\KeywordTok{paste}\NormalTok{(}\StringTok{'keywords='}\NormalTok{ , address ,}
              \StringTok{'&key='}\NormalTok{ ,key ,}
              \StringTok{'&subdistrict=1'}\NormalTok{ ,                                      }\CommentTok{#????ָ?????????????Ĳ㼶}
              \StringTok{'&extensions=all'}\NormalTok{,}
               \DataTypeTok{sep =} \StringTok{''}\NormalTok{)}
\NormalTok{  geoinfo<-}\KeywordTok{GET}\NormalTok{(url)}\OperatorTok{%>%}\StringTok{ }\KeywordTok{content}\NormalTok{(}\DataTypeTok{as=}\StringTok{"text"}\NormalTok{,}\DataTypeTok{encoding=}\StringTok{"UTF-8"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{        }\KeywordTok{fromJSON}\NormalTok{(}\DataTypeTok{flatten =} \OtherTok{TRUE}\NormalTok{)                                      }\CommentTok{#??????Ϣ???????ǿ???ѡ????                    }
  \KeywordTok{return}\NormalTok{(geoinfo)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

?????��???ֻ??Ҫһ??????\emph{address}??֧?????ĵ?????Ҳ֧????????ʽ?????????루adcode?????????ĵ?????ѯʱ?????С????????㼶???п????????????Ե??????ˣ?Ҳ????һ???ؼ??ֶ?Ӧ?????????????????ߵ½??????Ҿ?��ʹ??adcode????????\href{http://lbs.amap.com/api/webservice/download}{????}???ء????ǿ???ͨ???ϼ??????????????????¼???????????adcode???ǳ??򵥣???????????????ֱ??ץȡָ???????????????¼?????????adcode??ֵ??һ??????Ԥ???趨С????λ??\texttt{options(digits=11)}?????ڵ???????С????????λ???Ƚ϶࣬??????Ԥ??ָ??С????λ???Ļ???????RĬ?ϵľ??Ⱦͻ???????ʾ?????????????????棬???ǸϽ?��???㽭???????Ӱɡ?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{   zj<-}\KeywordTok{get_location}\NormalTok{(}\StringTok{'浙江省'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ '[['}\NormalTok{(}\StringTok{'districts'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

???ص???Ϣ??һ????????????Ԫ?ص??б���?????б???\emph{districts}Ԫ?ذ???????????Ҫ????????Ϣ????????????ֱ??һ????ȡ??��?ˣ?????Ȥ??С?????????Լ??鿴?????б?????Ϣ?????????Ǿ?��????????\emph{districts}Ԫ?س?ʲô???Ӱɡ?

\begin{verbatim}
## 'data.frame':    1 obs. of  7 variables:
##  $ citycode :List of 1
##   ..$ : list()
##  $ adcode   : chr "330000"
##  $ name     : chr "浙江省"
##  $ polyline : chr "121.134149,27.786010;121.134130,27.785898;121.134110,27.785840;121.134079,27.785817;121.134009,27.785782;121.13"| __truncated__
##  $ center   : chr "120.152585,30.266597"
##  $ level    : chr "province"
##  $ districts:List of 1
##   ..$ :'data.frame': 11 obs. of  6 variables:
##   .. ..$ citycode : chr  "0572" "0571" "0573" "0579" ...
##   .. ..$ adcode   : chr  "330500" "330100" "330400" "330700" ...
##   .. ..$ name     : chr  "湖州市" "杭州市" "嘉兴市" "金华市" ...
##   .. ..$ center   : chr  "120.086809,30.89441" "120.209789,30.24692" "120.75547,30.746191" "119.647229,29.079208" ...
##   .. ..$ level    : chr  "city" "city" "city" "city" ...
##   .. ..$ districts:List of 11
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
##   .. .. ..$ : list()
\end{verbatim}

Ϊ?˱Ƚ???????չʾ???ݽṹ????ѡ??ֻ????????һ????????????Ϣ??\texttt{subdistrict=1}????Ҳ?????㽭?ĵؼ?????Ϣ????ʵ???????趨\texttt{subdistrict=3}??????һ???????㽭??????????Ϣ??
\emph{polyline}????Ԫ????????????Ҫ?ҵ????????߽??ϵ???????????Ϣ??Ŀǰ??һ???ܳ????ַ???????????Ҫ?Ĺ?????ʵ???Ƿָ??ת?????͡???ת??????ϵ???????ɵ????ռ???????Ȼ???Ϳ?????ͼ��?????棬???Ǿ?��?????㽭ʡ?ı߽硣

\subsubsection{??ϴ??ת??}

\begin{verbatim}
##  chr "121.134149,27.786010;121.134130,27.785898;121.134110,27.785840;121.134079,27.785817;121.134009,27.785782;121.13"| __truncated__
\end{verbatim}

?Ϲ??أ???��????\emph{polyline}?Ľṹ?????ͣ??ַ????ͣ?chr)?????????Ծ?γ?ȵ???ʽ??¼?ģ???γ??֮????\textbf{``??''}?ָ����?ÿ??????֮????\textbf{``??''}?ָ????ں??棬???ǻ???????һ???ָ?????\textbf{``\textbar{}''}??????ʲô??˼?أ?????ʾ????????????ֻ??��һ???????Ρ????ڵ??졢?ɵص????͵?????????һ??ʡ???????????ܻ???��?ܶ??Ķ?��?????Ρ?ÿһ????????֮?䶼????\textbf{``\textbar{}''}��?ָ????˽??????????ݽṹ???Ϳ??Կ?ʼ???зָ???ת???ˡ????????????롣

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zj}\OperatorTok{$}\NormalTok{polyline<-zj}\OperatorTok{$}\NormalTok{polyline }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{str_split}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{|'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\KeywordTok{lapply}\NormalTok{(str_split,}\StringTok{';'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             '[['}\NormalTok{(}\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{lapply}\NormalTok{(str_split,}\StringTok{','}\NormalTok{) }\OperatorTok{%>%}\StringTok{     }\CommentTok{#???϶??ַ??????зָ����õ?һ??????Ƕ?׵??б?            }
\StringTok{             }\KeywordTok{lapply}\NormalTok{(lapply,as.numeric) }\OperatorTok{%>%}\StringTok{      }
\StringTok{             }\KeywordTok{lapply}\NormalTok{(list.rbind)}\OperatorTok{%>%}\StringTok{                    }\CommentTok{#ת?????????ͣ????ϲ??У??γ????ɾ?????}
\StringTok{  }
\StringTok{             }\KeywordTok{lapply}\NormalTok{(gcj02_wgs84_matrix_matrix) }\OperatorTok{%>%}\StringTok{    }\CommentTok{#ת??ͶӰ????ϵ}
\StringTok{  }
\StringTok{             }\KeywordTok{lapply}\NormalTok{(list) }\OperatorTok{%>%}\StringTok{ }
\StringTok{             }\NormalTok{st_multipolygon }\OperatorTok{%>%}\StringTok{ }\KeywordTok{st_sfc}\NormalTok{(}\DataTypeTok{crs=}\DecValTok{4326}\NormalTok{)     }\CommentTok{#??polyline?ж???Ϊsfc????}
\NormalTok{zj_sf<-}\KeywordTok{st_sf}\NormalTok{(zj)                                      }\CommentTok{#??????zj???ݿ?????Ϊsf????}
\end{Highlighting}
\end{Shaded}

????Ҫ??????ͷ??һ??????????

\begin{itemize}
\item
  ?б?????\textbf{rlist}????????R????????list???????в???????????????list?????ķǽṹ?ԣ????ҿ??Զ???Ƕ?ף?????һ???ַ??????????ηָ??????γ????????ĸ?????????Ƕ?׵?list???󣬺????Ĺ?????????????????ת??????????ϵ??ת?????漰????list?????????????????һ??????õ???\textbf{base}??????\texttt{lapply}????Ƕ????Ӧ?ԣ?????Ҳ?ٲ???Ҫ????\textbf{rlis
  t}?????ܶຯ?????????????Ĵ?????????????\textbf{rlist}???ĺ???ʵ????ֻ??\texttt{list.rbind}һ???ˣ?????ʵ?????ڵ??ԵĹ??????ҽ????˺ܶ??????????ĺ???????debug????????ץȡ??????????Ϣ????????Ȥ?Ļ???Ӧ?ö???Ҫ??ץ??��?????????Ƚ???һ???????Ĳ????ġ?
\item
  ????????ת??\textbf{Rgctc2}???????ڱ??ܵ???Ҫ???ߵ¡??ٶ??ṩ????????Ϣ???Ǿ???ת?????ܵģ?һ??ת????wgs84ͶӰ????ϵͨ???Ի????á?????ת???????и??????Ե?Դ????Ҳ?и???С???ߣ?????ĿǰR????????????û??ר??????????ת???İ????????Ҿ??Լ?????д??һ????????????\href{https://github.com/zhouqiangnju/R_coordination_transformation}{????}???ء??????????ܼܺ򵥣?Ŀǰ??ֻ?ܴӸߵ?ת????WGS84???????Ĺ???Ӧ????ʵ?ָߵ¡??ٶȡ?WGS84??????��??????ϵ??ת????????R??Ҫ?õķ??㻰??Ҫ???Ǹ??????????͵??????????????Ի??Ǹ??????Ĺ??̣?????????????Ȥ?????????ưɡ???Ϊ???ᣬ???Ի?û?и??????ĵ?????\texttt{gcj02}???Ǹߵ²??õ?????ϵ??\texttt{wgs84}??????Ҫת???ɵ?ͨ??????ϵ,\texttt{matrix\_matrix}?ֱ??????????????????????͡????????????еĺ????????϶?????????????????
\item
  ???ɵ????ռ?????\textbf{sf}????????\textbf{sp}???????????????????ڴ?ͳ??\textbf{sp}?????Բ??͵????ռ???Ϣ???ָ??ĸ??Ӵ洢??????\textbf{sf}?????ǻ??????ݿ??ģ??ǳ???????R?????н??в?????Ҳ?Ǹ?????????GIS???ݴ洢??ʽ??????Ŀǰ?õ???ggplot2??֧?֣?ר?ż???һ??????\texttt{geom\_sf}????\textbf{sf}????????ͼ??????Ŀǰ??��ǰ;?ǳ?????????
  ?????????ٿ?һ??zj???????ݿ???ʵ????ֻҪ??\emph{polyline}??һ??ת????\textbf{sf}??????????\emph{sfc}?У?Ҳ????ר?????ڴ洢?????ռ???Ϣ???У???????zj???ݿ??Ϳ??Զ?λΪ\textbf{sf}?????ˣ??ǳ????㡣\texttt{st\_sfc(crs=4326)}??????????????��ת??\emph{polyline}?еġ?ת?????ɺ??????ٿ?\emph{polyline}?е?????
\end{itemize}

\begin{verbatim}
## $class
## [1] "sfc_MULTIPOLYGON" "sfc"             
## 
## $precision
## [1] 0
## 
## $bbox
##          xmin          ymin          xmax          ymax 
## 118.023019231  27.044744711 122.945311212  31.180867236 
## 
## $crs
## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: "+proj=longlat +datum=WGS84 +no_defs"
## 
## $n_empty
## [1] 0
\end{verbatim}

???Կ??????Ѿ??????˺ܶ??????ռ???Ϣ??
???????ĵط????ڣ???ͬ?ĵ????ռ????????ͣ????ǵ㡢???棩????Ӧ??\emph{sfc}?ж????ݸ?ʽ??Ҫ????ͬ???ұȽ??ϸ񣬱???˵???????????õ?\emph{multipolygon}????????????ֻ????\emph{list(list(matrix),list(matirx),\ldots{}\ldots{})}???ָ?ʽ??????,????????\emph{matrix}?????????Թ??ɵľ?????????Ҳ????\emph{matrix(c(lng1,lat2),c(lng2,lat3)\ldots{}..)}????һ??һά?ľ???????R????????????һ???????????е㼼?ɵģ???Ҫһ??ʱ??��??Ϥ?????????????÷???

\#\#\#??ͼ
?????ѵĽ׶??Ѿ???ȥ��???????????????Ļ?ͼ��??????\textbf{ggplot2}??һ???????ͳ?ͼ??

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{ggplot}\NormalTok{()}\OperatorTok{+}\KeywordTok{geom_sf}\NormalTok{(}\DataTypeTok{data=}\NormalTok{zj_sf)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{利用高德地图_files/figure-latex/ggplot_zj-1} 

}

\caption{?<U+3F6D><U+02A1>??????<U+037C>}\label{fig:ggplot_zj}
\end{figure}

\#\#\#????
ͨ?????ϵķ????????ǿ???һ????????һ?????????ĵõ????ǵı߿???Ȼ??ͨ??\texttt{rbind}?õ???????????ͼ?ˡ?Ȼ?????????ķ?ʽ??̫low?ˡ?????Ҫ????????R????????\texttt{apply}???????壬һ???ӵõ??㽭ʡ???еؼ??е???????ͼ??ֱ???ϴ??롣

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zj_city<-zj }\OperatorTok{%>%}\StringTok{ "["}\NormalTok{(}\StringTok{'districts'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ '[['}\NormalTok{(}\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}\StringTok{ '[['}\NormalTok{(}\DecValTok{1}\NormalTok{)  }\CommentTok{#??ȡ??????adcode}
\NormalTok{zj_city<-}\KeywordTok{lapply}\NormalTok{(zj_city}\OperatorTok{$}\NormalTok{adcode,get_location)  }\OperatorTok{%>%}\StringTok{         }\CommentTok{#????lapply??????ȡ???г??еĵ?????Ϣ}
\StringTok{         }\KeywordTok{list.map}\NormalTok{(districts) }\OperatorTok{%>%}\StringTok{ }
\StringTok{         }\KeywordTok{lapply}\NormalTok{(select,}\OperatorTok{-}\NormalTok{districts) }\OperatorTok{%>%}\StringTok{ }
\StringTok{         }\NormalTok{list.rbind}
\NormalTok{zj_city}\OperatorTok{$}\NormalTok{polyline <-}\StringTok{ }\NormalTok{zj_city}\OperatorTok{$}\NormalTok{polyline }\OperatorTok{%>%}\StringTok{                    }
\StringTok{                    }\KeywordTok{str_split}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{|'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(str_split,}\StringTok{';'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(lapply,str_split,}\StringTok{','}\NormalTok{) }\OperatorTok{%>%}
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(lapply,lapply,as.numeric) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(lapply,list.rbind) }\OperatorTok{%>%}
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(lapply,gcj02_wgs84_matrix_matrix) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(lapply,list) }\OperatorTok{%>%}
\StringTok{                    }\KeywordTok{lapply}\NormalTok{(st_multipolygon) }\OperatorTok{%>%}\KeywordTok{st_sfc}\NormalTok{(}\DataTypeTok{crs=}\DecValTok{4326}\NormalTok{)}

\NormalTok{zj_city <-}\StringTok{ }\KeywordTok{st_sf}\NormalTok{(zj_city)}
\end{Highlighting}
\end{Shaded}

???Կ???��??????һ?δ??벻??????????һ??lapply???ѡ????????????Ȳ??ż???ͼ?????ǰѸ????е????ֱ???��??λ?þͷ??ڸߵ¸????ĳ???????λ?ã?ԭ֭ԭζ??????????Ҫ????һ????????ת????

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zj_city       <-zj_city}\OperatorTok{$}\NormalTok{center }\OperatorTok{%>%}\StringTok{ }
\StringTok{                }\KeywordTok{str_split}\NormalTok{(}\StringTok{';'}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                }\KeywordTok{lapply}\NormalTok{(str_split,}\StringTok{','}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                }\KeywordTok{lapply}\NormalTok{(lapply,as.numeric) }\OperatorTok{%>%}\StringTok{ }
\StringTok{                }\KeywordTok{lapply}\NormalTok{(list.rbind) }\OperatorTok{%>%}\StringTok{ }\NormalTok{list.rbind }\OperatorTok{%>%}\StringTok{ }
\StringTok{                }\NormalTok{gcj02_wgs84_matrix_df }\OperatorTok{%>%}
\StringTok{                }\KeywordTok{bind_cols}\NormalTok{(zj_city)}
\NormalTok{zj_city<-}\KeywordTok{st_sf}\NormalTok{(zj_city)}
\end{Highlighting}
\end{Shaded}

????��????һ?????ճɹ??ɡ?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{showtext_begin}\NormalTok{()}

\KeywordTok{ggplot}\NormalTok{()}\OperatorTok{+}\KeywordTok{geom_sf}\NormalTok{(}\DataTypeTok{data=}\NormalTok{zj_city)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{利用高德地图_files/figure-latex/city_map-1} 

}

\caption{?<U+3F6D><U+02A1>????????????<U+037C>}\label{fig:city_map}
\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{showtext_end}\NormalTok{()}
\end{Highlighting}
\end{Shaded}


\end{document}
